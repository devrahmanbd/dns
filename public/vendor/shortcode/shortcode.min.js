var Shortcode=function(e,t){e&&(this.el=e,this.tags=t,this.matches=[],this.regex="\\[{name}(\\s[\\s\\S]*?)?\\](?:((?!\\s*?(?:\\[{name}|\\[\\/(?!{name})))[\\s\\S]*?)(\\[/{name}\\]))?",this.el.jquery&&(this.el=this.el[0]),this.matchTags(),this.convertMatchesToNodes(),this.replaceNodes())};Shortcode.prototype.matchTags=function(){var e,t,r,a,s,n,o,c=this.el.outerHTML;for(var i in this.tags){if(!this.tags.hasOwnProperty(i))return;r=this.template(this.regex,{name:i}),e=c.match(new RegExp(r,"g"))||[];for(var h=0,p=e.length;h<p;h++)t=e[h].match(new RegExp(r)),a=t[3]?"":void 0,n=t[0],s=this.escapeTagRegExp(n),o=this.parseOptions(t[1]),t[2]&&(a=t[2].trim(),n=n.replace(a,"").replace(/\n\s*/g,""),s=this.escapeTagRegExp(n).replace("\\]\\[","\\]([\\s\\S]*?)\\[")),this.matches.push({name:i,tag:n,regex:s,options:o,contents:a})}},Shortcode.prototype.convertMatchesToNodes=function(){var e,t,r,a=this.el.innerHTML;r=function(e,t,r,a,s,n,o){if(t)return e;var c=document.createElement("span");return c.setAttribute("data-sc-tag",this.tag),c.className="sc-node sc-node-"+this.name,c.outerHTML};for(var s=0,n=this.matches.length;s<n;s++)e='((data-sc-tag=")|(<pre.*)|(<code.*))?',t=new RegExp(e+this.matches[s].regex,"g"),a=a.replace(t,r.bind(this.matches[s]));this.el.innerHTML=a},Shortcode.prototype.replaceNodes=function(){var e,t,r,a,s,n,o=this;this.el.querySelectorAll(".sc-node");n=function(e){e.jquery&&(e=e[0]),e=o.parseCallbackResult(e),a.parentNode.replaceChild(e,a)};for(var c=0,i=this.matches.length;c<i;c++)e=this.matches[c],a=this.el.querySelector(".sc-node-"+e.name),a&&a.dataset.scTag===e.tag&&(s=this.tags[e.name].bind(e),r=n.bind(e),t=s(r),void 0!==t&&r(t))},Shortcode.prototype.parseCallbackResult=function(e){var t,r,a;switch(typeof e){case"function":e=document.createTextNode(e());break;case"string":if(t=document.createElement("div"),r=document.createDocumentFragment(),t.innerHTML=e,a=t.childNodes,a.length){for(var s=0,n=a.length;s<n;s++)r.appendChild(a[s].cloneNode(!0));e=r}else e=document.createTextNode(e);break;case"object":e.nodeType||(e=JSON.stringify(e),e=document.createTextNode(e))}return e},Shortcode.prototype.parseOptions=function(e){var t,r={};if(e){t=e.replace(/(\w+=)/g,"\n$1").split("\n"),t.shift();for(var a=0;a<t.length;a++){var s=t[a].split("=");r[s[0]]=s[1].replace(/\'|\"/g,"").trim()}return r}},Shortcode.prototype.escapeTagRegExp=function(e){return e.replace(/[\[\]\/]/g,"\\$&")},Shortcode.prototype.template=function(e,t){for(var r in t)e=e.replace(new RegExp("{"+r+"}","g"),t[r]);return e},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};